<!doctype html>
<html>
    <head>
        <style type="text/css">
            #map {
                width: 1100px;
                height: 800px;
                border: 1px solid black;
                margin-top: 50px;
                margin-left: auto;
                margin-right: auto;
            }
        </style>
    </head>
    <body>
        <div id="map"></div> 
        <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
        <script src="https://cdn.rawgit.com/d3/d3-geo-projection/master/d3.geo.projection.js"></script>
        <script src="https://cdn.rawgit.com/mbostock/topojson/master/topojson.js"></script>
        <script src="d3-grid-map.js"></script>
        <script type="text/javascript">
            d3.json('countries.topojson', function(error, countries) {
              var options = {
                countries: countries
              };
              var w = 720;
              var h = 360;
              var k = 0;
              // new up some fake data
                function calc(i,j) {
                    var zn = [0, 0];
                    var n = 0;
                    var mag = 0;
                    while (mag < 100 && n < 255) {
                       var zn2 = [ (zn[0]*zn[0]-zn[1]*zn[1]), (zn[0]*zn[1] + zn[1]*zn[0] )]
                       zn[0] = zn2[0] + i
                       zn[1] = zn2[1] + j
                       mag = Math.sqrt(zn[0]*zn[0]+zn[1]*zn[1]);
                       n++; 
                    }
                    console.log(i,j,n, mag);
                    return n;
                }
              var data = new Uint32Array(200*300); 
              var x = -1;
              for (var j=100; j<200; j++) {
                  for (var i=200; i<300; i++) {
                    var cell_id = j*w + i
                    n = calc((i-250) / 30,(j-150)/50);
                    var val = (n << 24) | (cell_id & 0xffffff);
                    data[x++] = val; 
                    }
              }
              var map = d3.geo.GridMap;
              map.init('#map', [w, h], options);
              map.setDataArrayBuffer(data.buffer);
            });
        </script>
    </body>
</html>
