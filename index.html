<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <style type="text/css">
            .map {
                width: 90%;
                margin: 20px;
                margin-left:auto;
                margin-right:auto;
                height: 500px;
                border: 1px solid black;
                position: relative;
            }
        </style>
    </head>
    <body>
        <a href="https://github.com/VulcanTechnologies/d3-grid-map"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>

        <h1>d3-grid-map</h1>
        <p>D3 gridded data set mapper
        <p>
            <a href="https://github.com/VulcanTechnologies/d3-grid-map">d3-grid-map on GitHub</a>
        </p>
        <p>
        This package will create a geographic map using D3 using any supported projection. Arbitrary numbers of layers of gridded binary data or geojson/topojson can be added.   
        </p>
        <p>
            Country outlines can be drawn from the included countries.topojson data.
        </p>

        <div class="map" id="map1"></div>
        <div class="map" id="map2"></div>
        <div class="map" id="map3"></div>

        <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
        <script src="https://cdn.rawgit.com/d3/d3-geo-projection/master/d3.geo.projection.js"></script>
        <script src="https://cdn.rawgit.com/mbostock/topojson/master/topojson.js"></script>
        <script src="https://cdn.rawgit.com/VulcanTechnologies/d3-grid-map/6ff15fa730393d2f0f346f78486fc00a4ec7aa36/d3-grid-map.min.js"></script>

        <script type="text/javascript">

          var w = 720;
          var h = 360;
          var options = {
            hud: {
              fontSize: 20,
              fontColor: 'white',
              verticalOffset: 5
            },
            onCellHover: function(feature) { console.log('hovering over ', feature);},
            legend: false,
            colorScale: d3.scale.quantile().range(['#fff7f3','#fde0dd','#fcc5c0','#fa9fb5','#f768a1','#dd3497','#ae017e','#7a0177','#49006a'])
          };

          var map1 = new d3.geo.GridMap('#map1', options);

          options.projection = d3.geo.mercator();
          options.seaColor = 'rgba(255,0,0,1)';
          var map2 = new d3.geo.GridMap('#map2', options);

          options.projection = d3.geo.orthographic().clipAngle(90);
          options.seaColor = 'rgba(0,0,255,1)';
          options.scale = 250;
          options.latitude = -17;
          options.longitude = 150;
          var map3 = new d3.geo.GridMap('#map3', options);

          d3.json('countries.topojson', function(error, countries) {
            map1.addLayer(countries);
            map2.addLayer(countries, {fillColor: 'rgba(22,22,22,1)'});
            map3.addLayer(countries, {fillColor: 'white'});
          });

          d3.json('eez.json', function(error, eez) {
            map1.addLayer(eez, {
              strokeColor: 'rgba(0,0,0,1)',
              fillColor: 'rgba(0,0,0,.2)',
              zIndex: 4,
              renderOnAnimate: true
            });
          });

          // add a float32 array data set to a map
          d3.xhr('data/float32.dat')
            .responseType('arraybuffer')
            .get(function(error, xhr) {
              var data = new Float32Array(xhr.response);
              map1.colorScale.domain(data);
              map3.colorScale.domain(data);
              var layerOptions = {gridSize: [w, h], zIndex: 3, renderOnAnimate: false};
              map1.addLayer(data, layerOptions);
              map3.addLayer(data, layerOptions);
            });

          map1.dispatch.on('drawStart', function() {console.log('drawing Started'); });
          map1.dispatch.on('drawEnd', function() {console.log('drawing Ended'); });

        </script>
    </body>
</html>
