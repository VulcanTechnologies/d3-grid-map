<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <style type="text/css">
            .map {
                width: 700px;
                height: 500px;
                border: 1px solid black;
                margin: 0px;
                float: left;
                position: relative;
            }
        </style>
    </head>
    <body>
        <div class="map" id="map1"></div>
        <div class="map" id="map2"></div>
        <div class="map" id="map3"></div>
        <div class="map" id="map4"></div>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
        <script src="https://cdn.rawgit.com/d3/d3-geo-projection/master/d3.geo.projection.js"></script>
        <script src="https://cdn.rawgit.com/mbostock/topojson/master/topojson.js"></script>
        <script src="d3-grid-map.js"></script>
        <script type="text/javascript">
          var w = 720;
          var h = 360;

          // create a data grid of this size and position
          var grid_w = 50;
          var grid_h = 50;
          var grid_ul_x = 200; //335;
          var grid_ul_y = 100; //155;

          var data = new Uint32Array(grid_w * grid_h);
          var index = -1;
          for (var j=0; j<grid_h; j++) {
              for (var i=0; i<grid_w; i++) {
                index++;
                var cell_id = (grid_ul_y + j)*w + (grid_ul_x + i);

                var cell_value = ~~(Math.random()*255);
                var val = ((cell_value & 0xff) << 24) | (cell_id & 0xffffff);
                data[index] = val;

              }
          }
          d3.json('countries.topojson', function(error, countries) {
            var options = {
              countries: countries,
              hud: {
                fontSize: 20,
                fontColor: 'white',
                verticalOffset: 5
              },
              onCellHover: function(feature) { console.debug('hovering over ', feature);}
            };

            var map1 = new d3.geo.GridMap('#map1', [w, h], options);
            map1.setData(data.buffer);
            map1.panToCentroid();

            options.projection = d3.geo.mercator();
            var map2 = new d3.geo.GridMap('#map2', [w, h], options);
            map2.setDataArrayBuffer(data.buffer);
            map2.panToCentroid();

            options.projection = d3.geo.orthographic().clipAngle(90);
            var map3 = new d3.geo.GridMap('#map3', [w, h], options);
            map3.setDataArrayBuffer(data.buffer);
            map3.panToCentroid();

            options.projection = d3.geo.airy();
            var map4 = new d3.geo.GridMap('#map4', [w, h], options);
            map3.setDataArrayBuffer(data.buffer);
          });
        </script>
    </body>
</html>
