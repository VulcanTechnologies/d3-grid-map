<!doctype html>
<html>
    <head>
        <style type="text/css">
            #map {
                width: 1100px;
                height: 800px;
                border: 1px solid black;
                margin-top: 50px;
                margin-left: auto;
                margin-right: auto;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
        <script src="https://cdn.rawgit.com/d3/d3-geo-projection/master/d3.geo.projection.js"></script>
        <script src="https://cdn.rawgit.com/mbostock/topojson/master/topojson.js"></script>
        <script src="d3-grid-map.js"></script>
        <script type="text/javascript">
          d3.json('countries.topojson', function(error, countries) {
            var options = {
              countries: countries
            };
            var w = 720;
            var h = 360;

            // create a data grid of this size and position
            var grid_w = 50;
            var grid_h = 50;
            var grid_ul_x = 335;
            var grid_ul_y = 155;

            var data = new Uint32Array(grid_w * grid_h);
            var x = -1;
            for (var j=0; j<grid_h; j++) {
                for (var i=0; i<grid_w; i++) {
                  var cell_id = (grid_ul_y + j)*w + (grid_ul_x + i);
                  var cell_value = ~~(Math.random()*255);
                  var val = (cell_value << 24) | (cell_id & 0xffffff);
                  data[x++] = val;
                }
            }
            var map = d3.geo.GridMap;
            map.init('#map', [w, h], options);
            map.setDataArrayBuffer(data.buffer);
          });
        </script>
    </body>
</html>
